<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PG Theater Call Board</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: black;
      color: gold;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header {
      background: gold;
      color: black;
      width: 100%;
      padding: 15px;
      text-align: center;
      font-size: 1.5em;
      font-weight: bold;
    }
    .container {
      margin-top: 20px;
      width: 95%;
      max-width: 1100px;
    }
    .hidden { display: none; }
    button {
      background: gold;
      color: black;
      border: none;
      padding: 8px 12px;
      margin: 3px;
      cursor: pointer;
      transition: 0.3s;
      border-radius: 4px;
    }
    button:hover { background: #ffcc00; }
    input, select, textarea {
      padding: 8px;
      margin: 5px 0;
      width: 100%;
    }
    .card {
      background: #222;
      padding: 15px;
      margin: 10px 0;
      border: 1px solid gold;
      border-radius: 6px;
    }
    h2 { border-bottom: 1px solid gold; padding-bottom: 5px; }

    /* Attendance Table */
    #attendanceTable {
      width: 100%;
      border-collapse: collapse;
    }
    #attendanceTable th, #attendanceTable td {
      border: 1px solid gold;
      padding: 6px;
      text-align: center;
    }
    #attendanceWrapper {
      max-height: 400px;
      overflow-y: auto;
      margin-top: 10px;
    }
  </style>
</head>
<body>
<header>PG Theater Call Board</header>

<div class="container">

  <!-- Login Screen -->
  <div id="loginScreen">
    <h2>Login</h2>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Sign In</button>
    <p id="loginError" style="color:red;"></p>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="hidden">
    <button onclick="logout()">Sign Out</button>
    <h2 id="welcome"></h2>

    <div id="announcements" class="card">
      <h2>Announcements</h2>
      <div id="announcementList"></div>
      <div id="announcementForm" class="hidden">
        <textarea id="newAnnouncement" placeholder="Write announcement..."></textarea>
        <button onclick="addAnnouncement()">Add Announcement</button>
      </div>
    </div>

    <div id="calls" class="card hidden">
      <h2>Calls</h2>
      <div id="callList"></div>
      <div id="callForm" class="hidden">
        <select id="callActor"></select>
        <button onclick="addCall()">Add Call</button>
      </div>
    </div>

    <div id="attendance" class="card hidden">
      <h2>Attendance</h2>
      <div id="attendanceWrapper">
        <table id="attendanceTable">
          <thead>
            <tr>
              <th>Actor</th>
              <th>Status</th>
              <th class="manageCol hidden">Actions</th>
            </tr>
          </thead>
          <tbody id="attendanceList"></tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyAACv92bzY5cECbECBtsw6oyxrUnEBaJMY",
    authDomain: "pg-theater-call-board.firebaseapp.com",
    projectId: "pg-theater-call-board",
    storageBucket: "pg-theater-call-board.appspot.com",
    messagingSenderId: "850857757575",
    appId: "1:850857757575:web:8b2f93e76b2cf008aea122",
    measurementId: "G-ELWLH31ZCJ"
  };
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Accounts
  const accounts = {
    "lnewton": {password:"?2@2yzz~PVJf", role:"Director"},
    "tbeck": {password:"pHR68Db.Pw.#", role:"Director"},
    "gloshe": {password:"iT=hy!7G9NTf", role:"Director"},
    "bflieder": {password:"-W9m=>D_AUzF", role:"Director"},
    "cclark": {password:"iJ+va7>Df}#@", role:"Director"},
    "ljulien": {password:";3y2Paz9£9?m", role:"Stage Manager"},
    "hflowers": {password:"i£08um?B51.x", role:"Stage Manager"},
    "nwalker": {password:"9^1~R7C*QVdV", role:"Stage Manager"},
    "apate": {password:"y~D+V3R-37Wt", role:"Actor"},
    "cbeck": {password:"G?5sLRCkZYCg", role:"Actor"},
    "sjulien": {password:"#0Y57gk*b?Jq", role:"Actor"},
    "agipson": {password:"c!?xGW2JvB:2", role:"Actor"},
    "owyatt": {password:"9vq-B#4q]}>.", role:"Actor"},
    "swyatt": {password:"B?2jjtvNqtq_", role:"Actor"},
    "afry": {password:"5Mxc,kQpd,!T", role:"Actor"},
    "rromero": {password:"=4A*pq+xQq:!", role:"Actor"},
    "gromero": {password:"j.dab8,6X_m2", role:"Actor"}
  };

  let currentUser = null;

  // Login
  function login(){
    let u = document.getElementById("username").value.trim();
    let p = document.getElementById("password").value.trim();
    if(accounts[u] && accounts[u].password===p){
      currentUser = {name:u, role:accounts[u].role};
      document.getElementById("loginScreen").classList.add("hidden");
      document.getElementById("dashboard").classList.remove("hidden");
      document.getElementById("welcome").innerText = "Welcome, " + u + " ("+currentUser.role+")";
      if(currentUser.role==="Director" || currentUser.role==="Stage Manager"){
        document.getElementById("announcementForm").classList.remove("hidden");
        document.getElementById("calls").classList.remove("hidden");
        document.getElementById("attendance").classList.remove("hidden");
        document.getElementById("callForm").classList.remove("hidden");
        document.querySelector(".manageCol").classList.remove("hidden");
      }
      loadAnnouncements();
      loadCalls();
      loadAttendance();
    } else {
      document.getElementById("loginError").innerText = "Invalid login.";
    }
  }
  function logout(){
    currentUser=null;
    document.getElementById("dashboard").classList.add("hidden");
    document.getElementById("loginScreen").classList.remove("hidden");
  }

  // Announcements
  function addAnnouncement(){
    let txt = document.getElementById("newAnnouncement").value;
    if(txt){
      db.collection("announcements").add({text:txt, by:currentUser.name, time:Date.now()});
      document.getElementById("newAnnouncement").value="";
    }
  }
  function loadAnnouncements(){
    db.collection("announcements").orderBy("time","desc").onSnapshot(snap=>{
      let list=document.getElementById("announcementList"); list.innerHTML="";
      snap.forEach(doc=>{
        let d=doc.data();
        list.innerHTML+=`<p><b>${d.by}</b>: ${d.text}</p>`;
      });
    });
  }

  // Calls
  function addCall(){
    let actor=document.getElementById("callActor").value;
    db.collection("calls").add({actor:actor, by:currentUser.name, time:Date.now()});
  }
  function loadCalls(){
    // fill actor list
    let sel=document.getElementById("callActor"); sel.innerHTML="";
    for(let u in accounts){ if(accounts[u].role==="Actor") sel.innerHTML+=`<option>${u}</option>`; }
    db.collection("calls").orderBy("time","desc").onSnapshot(snap=>{
      let list=document.getElementById("callList"); list.innerHTML="";
      snap.forEach(doc=>{
        let d=doc.data();
        if(currentUser.role==="Actor"){
          if(currentUser.name===d.actor){
            list.innerHTML+=`<p>You have been called by ${d.by}</p>`;
          }
        } else {
          list.innerHTML+=`<p><b>${d.actor}</b> was called by ${d.by}</p>`;
        }
      });
    });
  }

  // Attendance
  function loadAttendance(){
    db.collection("attendance").onSnapshot(snap=>{
      let list=document.getElementById("attendanceList"); list.innerHTML="";
      for(let u in accounts){
        if(accounts[u].role==="Actor"){
          let status="Not Marked";
          snap.forEach(doc=>{let d=doc.data(); if(d.user===u) status=d.status;});
          let row=`<tr><td>${u}</td><td>${status}</td>`;
          if(currentUser.role!=="Actor"){
            row+=`<td>
              <button onclick="mark('${u}','Present')">Present</button>
              <button onclick="absentMenu('${u}')">Absent</button>
              <button onclick="mark('${u}','Tardy')">Tardy</button>
              <button onclick="mark('${u}','Left Early')">Left Early</button>
            </td>`;
          }
          row+=`</tr>`;
          list.innerHTML+=row;
        }
      }
    });
  }
  function absentMenu(u){
    let reason=prompt("Reason? (Football, Band, Sick, Other)");
    if(reason) mark(u,"Absent - "+reason);
  }
  function mark(u,status){
    db.collection("attendance").doc(u).set({user:u, status:status});
  }
</script>
</body>
</html>


 